@model Municipal_services_app.Models.EventsIndexViewModel

@{
    ViewData["Title"] = "Municipal Updates";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    body {
        background: #0a1f44;
        color: #ffffff;
    }

    .card-announcement, .card-event, .recommend-card {
        border: none;
        border-radius: 12px;
        padding: 1rem;
        background: linear-gradient(135deg, #0d47a1, #1976d2);
        color: #ffffff;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card-announcement:hover, .card-event:hover, .recommend-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }

    .badge-category {
        font-size: 0.8rem;
        background-color: rgba(255, 255, 255, 0.2);
        color: #ffffff;
    }

    .section-title {
        margin-top: 2rem;
        margin-bottom: 1rem;
        border-bottom: 2px solid #1976d2;
        padding-bottom: 0.3rem;
        color: #ffffff;
    }

    input, select, button {
        border-radius: 6px;
    }

    input, select {
        border: none;
        padding: 0.5rem;
    }

    button {
        background-color: #1976d2;
        border: none;
        color: white;
        font-weight: 500;
    }

    button:hover {
        background-color: #1565c0;
    }

    .card-footer {
        background: transparent;
        border-top: 1px solid rgba(255,255,255,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.8rem;
    }
</style>

<div class="container my-4">

    <h1 class="mb-4 text-white">Municipal Updates</h1>

    <!-- Search & Filter Form -->
    <form method="get" asp-action="Load" class="row g-2 mb-4">
        <div class="col-md-3">
            <input type="text" name="q" value="@Model.Query" placeholder="Search events..." class="form-control" />
        </div>
        <div class="col-md-3">
            <select name="category" class="form-select">
                <option value="All">All Categories</option>
                @foreach (var cat in Model.Categories)
                {
                    if (cat == Model.SelectedCategory)
                    {
                        <option value="@cat" selected>@cat</option>
                    }
                    else
                    {
                        <option value="@cat">@cat</option>
                    }
                }
            </select>
        </div>
        <div class="col-md-2">
            <input type="date" name="from" value="@(Model.From?.ToString("yyyy-MM-dd"))" class="form-control" />
        </div>
        <div class="col-md-2">
            <input type="date" name="to" value="@(Model.To?.ToString("yyyy-MM-dd"))" class="form-control" />
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn w-100">Search</button>
        </div>
    </form>

    <!-- Announcements -->
    <h2 class="section-title">Announcements (@Model.Announcements.Count)</h2>
    @if (!Model.Announcements.Any())
    {
        <p>No announcements available.</p>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-2 g-3 mb-4">
            @foreach (var ann in Model.Announcements.OrderByDescending(a => a.DatePosted))
            {
                <div class="col">
                    <div class="card card-announcement h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">@ann.Title</h5>
                            <p class="card-text">@ann.Message</p>
                        </div>
                        <div class="card-footer">
                            <small>@ann.DatePosted.ToString("dd MMM yyyy")</small>
                            <span class="badge badge-category">@ann.Category</span>
                        </div>
                    </div>
                </div>
            }
        </div>
    }

    <!-- Events -->
    <h2 class="section-title">Events (@Model.Events.Count)</h2>
    @if (!Model.Events.Any())
    {
        <p>No events found.</p>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-2 g-3 mb-4">
            @foreach (var ev in Model.Events)
            {
                <div class="col">
                    <div class="card card-event h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">@ev.Title</h5>
                            <p class="card-text">@ev.Description</p>
                            <p class="mb-1"><strong>Location:</strong> @ev.Location</p>
                            <p class="mb-1"><strong>Date:</strong> @ev.Date.ToString("dd MMM yyyy")</p>
                            <p class="mb-1"><strong>Organizer:</strong> @ev.Organizer</p>
                            <span class="badge badge-category">@ev.Category</span>
                        </div>
                    </div>
                </div>
            }
        </div>
    }

    <!-- Recommended Events -->
    <h2 class="section-title">Recommended Events</h2>
    @if (!Model.Recommendations.Any())
    {
        <p>No recommendations at the moment.</p>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-2 g-3 mb-4">
            @foreach (var ev in Model.Recommendations)
            {
                <div class="col">
                    <div class="card recommend-card h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">@ev.Title</h5>
                            <p class="mb-1"><strong>Date:</strong> @ev.Date.ToString("dd MMM yyyy")</p>
                            <p class="mb-1"><strong>Category:</strong> @ev.Category</p>
                            <p class="mb-1"><strong>Organizer:</strong> @ev.Organizer</p>
                        </div>
                    </div>
                </div>
            }
        </div>
    }

</div>
